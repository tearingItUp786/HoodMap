<?php
 require_once('lib/OAuth.php');$CONSUMER_KEY='etEGHhav9psQyyA29O6DJA';$CONSUMER_SECRET='RhcStxf8mTeS-5aSdYvKamWxbB4';$TOKEN='yo5phN4iuPUV4tI8fzAcjTK3Wej1skzZ';$TOKEN_SECRET='jTRCy3CkKqVW5C2jfiYwLoRtB7w';$API_HOST='api.yelp.com';$DEFAULT_TERM="indian";$DEFAULT_LOCATION='Vancouver, Canada';$DEALS=true;$RADIUS=3000;$SEARCH_LIMIT=15;$SEARCH_PATH='/v2/search/';$BUSINESS_PATH='/v2/business/';function request($host,$path){$unsigned_url="https://".$host.$path;$token=new OAuthToken($GLOBALS['TOKEN'],$GLOBALS['TOKEN_SECRET']);$consumer=new OAuthConsumer($GLOBALS['CONSUMER_KEY'],$GLOBALS['CONSUMER_SECRET']);$signature_method=new OAuthSignatureMethod_HMAC_SHA1();$oauthrequest=OAuthRequest::from_consumer_and_token($consumer,$token,'GET',$unsigned_url);$oauthrequest->sign_request($signature_method,$consumer,$token);$signed_url=$oauthrequest->to_url();try{$ch=curl_init($signed_url);if(FALSE===$ch) throw new Exception('Failed to initialize');curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);curl_setopt($ch,CURLOPT_HEADER,0);$data=curl_exec($ch);if(FALSE===$data) throw new Exception(curl_error($ch),curl_errno($ch));$http_status=curl_getinfo($ch,CURLINFO_HTTP_CODE);if(200!=$http_status) throw new Exception($data,$http_status);curl_close($ch);}catch(Exception$e){trigger_error(sprintf('Curl failed with error #%d: %s',$e->getCode(),$e->getMessage()),E_USER_ERROR);}return $data;}function search($term,$location){$url_params=array();$url_params['term']=$term?:$GLOBALS['DEFAULT_TERM'];$url_params['location']=$location?:$GLOBALS['DEFAULT_LOCATION'];$url_params['limit']=$GLOBALS['SEARCH_LIMIT'];$search_path=$GLOBALS['SEARCH_PATH']."?".http_build_query($url_params);return request($GLOBALS['API_HOST'],$search_path);}function get_business($business_id){$business_path=$GLOBALS['BUSINESS_PATH'].$business_id;return request($GLOBALS['API_HOST'],$business_path);}function query_api($term,$location){$response=search($term,$location);echo $response;}$longopts=array("term::","location::",);$options=getopt("",$longopts);$term=$options['term']?:$_POST['term']?:'';$location=$options['location']?:$_POST['location']?:'';query_api($term,$location);?>
