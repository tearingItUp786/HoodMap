function loadScript(e){var o=document.createElement("script");o.type="text/javascript",o.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGpIQbpJCEJPolgUzC8Qnw9vhLfJl6HM8&signed_in=true&libraries=places",document.body.appendChild(o),o.onload=function(){var o=document.createElement("script");o.type="text/javascript",o.src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox_packed.js",document.body.appendChild(o),o.onload=e}}function initMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:10,center:hoodCoordinates,disableDefaultUI:!0}),geocoder=new google.maps.Geocoder;var e={disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{background:"url('http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/examples/tipbox.gif') no-repeat",opacity:.75,width:"100%",maxWidth:"425px",padding:"0"},closeBoxMargin:"8px 2px 2px 2px",closeBoxURL:"/NeighborHoodMap/images/square.png",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1};infoBox=new InfoBox(e),drawMarkers(),google.maps.event.addListener(infoBox,"closeclick",function(){myListView.currentPlace(null)}),google.maps.event.addListener(map,"click",function(e){})}function drawMarkers(){for(var e=0;e<myListView.placeList().length;e++){var o=myListView.placeList()[e],t=new google.maps.Marker({animation:google.maps.Animation.DROP,position:{lat:o.latitude(),lng:o.longitude()},icon:"/NeighborHoodMap/images/location.png"});o.marker=t,o.marker.setMap(map),google.maps.event.addListener(o.marker,"click",function(e){return function(t){o=myListView.placeList()[e],myListView.currentPlace(o),map.setCenter(o.marker.getPosition());var a=document.createElement("div");a.id="ib-container",a.innerHTML='<div class="header"><h1>'+o.name()+"</h1><h2>"+o.display_phone()+'</h2><h3 class="sub-title">'+o.location()+'</h3></div><div class="ib-content"><h3><a href="'+o.mobile_url()+'">Yelp It!</a></h3><p>'+o.snippet_text()+'</p><img src="'+o.imageURL()+'"/></div>',infoBox.setContent(a),infoBox.open(map,this),myListView.scroll()}}(e))}}function retrieveYelpData(e,o,t){$.ajax({url:"php/sample.php",async:!0,type:"POST",data:{term:e,location:o},dataType:"json",success:function(e){t(e.businesses)},error:function(e,o,t){console.log(o,t),alert("Ajax called failed. Markers will not be made")}})}function codeAddress(e){var o=document.getElementById("location").value;geocoder.geocode({address:o},function(o,t){t==google.maps.GeocoderStatus.OK?(map.setCenter(o[0].geometry.location),e()):alert("Geocode was not successful for the following reason: "+t)})}function setMapOnAll(e){for(var o=0;o<myListView.placeList().length;o++)myListView.placeList()[o].marker.setMap(e)}function clearMarkers(){infoBox.close(),setMapOnAll(null)}function parseForm(){var e=document.getElementById("location").value,o=document.getElementById("yterm").value;retrieveYelpData(o,e,function(e){clearMarkers(),myListView.placeList.removeAll(),e.forEach(function(e){var o=new Place(e);myListView.placeList.push(o)}),codeAddress(drawMarkers)})}var hoodCoordinates={lat:49.246292,lng:-123.116226},geocoder,map,infoBox,Place=function(e){this.name=ko.observable(e.name),this.location=ko.observable(e.location.display_address),this.latitude=ko.observable(e.location.coordinate.latitude),this.longitude=ko.observable(e.location.coordinate.longitude),this.imageURL=ko.observable(e.image_url),this.snippet_text=ko.observable(e.snippet_text),this.mobile_url=ko.observable(e.mobile_url),this.display_phone=ko.observable(e.display_phone),this.rating=ko.observable(e.rating),this.active=ko.observable(!1),this.fullName=ko.computed(function(){return this.name()+" <br/><span>Yelp Rating: "+this.rating()+"</span>"},this)},ListviewModel=function(){var e=this;e.placeList=ko.observableArray([]),e.currentPlace=ko.observable(),function(){retrieveYelpData("","",function(o){o.forEach(function(o){var t=new Place(o);e.placeList.push(t)}),loadScript(initMap)})}(),e.displayInfo=function(e){google.maps.event.trigger(e.marker,"click")},e.styling=function(o){return o===e.currentPlace()?"active":""},e.toggle=function(o){o===e.currentPlace()&&e.currentPlace().active(!e.currentPlace().active())},e.scroll=function(){var e=$("#locations"),o=$("li.nav-item.active");e.scrollTop(o.offset().top-e.offset().top+e.scrollTop())}};myListView=new ListviewModel,ko.applyBindings(myListView);